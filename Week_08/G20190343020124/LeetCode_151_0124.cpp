class Solution
{
public:
    string reverseWords(string s)
    {
        reverse(s.begin(), s.end()); //整体反转
        int start = 0, end = s.size() - 1;
        while (start < s.size() && s[start] == ' ')
            start++; //首空格
        while (end >= 0 && s[end] == ' ')
            end--; //尾空格
        if (start > end)
            return ""; //特殊情况

        for (int r = start; r <= end;)
        { //逐单词反转
            while (s[r] == ' ' && r <= end)
                r++;
            int l = r;
            while (s[l] != ' ' && l <= end)
                l++;
            reverse(s.begin() + r, s.begin() + l);
            r = l;
        }

        int tail = start; //处理中间冗余空格
        for (int i = start; i <= end; i++)
        {
            if (s[i] == ' ' && s[i - 1] == ' ')
                continue;
            s[tail++] = s[i];
        }
        return s.substr(start, tail - start);
    }
};